<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>World Meeting 2025</title>
  <meta name='robots' content='max-image-preview:large'/>
  
  <!-- DNS Prefetch -->
  <link rel='dns-prefetch' href='//fonts.googleapis.com'/>
  
  <!-- WordPress Generated Styles (if needed) -->
  <link rel="profile" href="http://gmpg.org/xfn/11">
  <link rel="pingback" href="https://wmagm.is/xmlrpc.php">
  
  <!-- Inline style (if required) -->
  <style>
    img:is([sizes="auto" i], [sizes^="auto," i]) {
      contain-intrinsic-size: 3000px 1500px;
    }
  </style>
  
  <!-- CSS References from your main site -->
  <link rel='stylesheet' id='wp-block-library-css' href='https://wmagm.is/wp-includes/css/dist/block-library/style.min.css?ver=6.7.2' type='text/css' media='all'/>
  <link rel='stylesheet' id='bootstrap-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/css/bootstrap.min.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='font-awesome-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/css/font-awesome.min.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='flickity.min.css-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/css/flickity.min.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='magnific-popup.css-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/css/magnific-popup.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='jquery.countdown.css-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/js/countdown/jquery.countdown.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='dione_main.css-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/css/dione_main.min.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='ova-dione-default-css' href='https://wmagm.is/wp-content/themes/ova-dione/assets/css/default.min.css' type='text/css' media='all'/>
  <link rel='stylesheet' id='ova-dione-style-css' href='https://wmagm.is/wp-content/themes/ova-dione/style.css' type='text/css' media='all'/>
  
  <!-- Favicon and icons (optional) -->
  <link rel="icon" href="https://wmagm.is/wp-content/uploads/2024/09/cropped-WMAM-41-club-32x32.png" sizes="32x32"/>
  <link rel="icon" href="https://wmagm.is/wp-content/uploads/2024/09/cropped-WMAM-41-club-192x192.png" sizes="192x192"/>
  <link rel="apple-touch-icon" href="https://wmagm.is/wp-content/uploads/2024/09/cropped-WMAM-41-club-180x180.png"/>
  <meta name="msapplication-TileImage" content="https://wmagm.is/wp-content/uploads/2024/09/cropped-WMAM-41-club-270x270.png"/>
  
  <!-- Custom inline styles (optional) -->
  <style type="text/css" id="custom-background-css">
body.custom-background {
  background-image: url("https://wmagm.is/wp-content/uploads/2024/10/Vesturbaer_medium1600x910.jpg");
  background-position: center top;
  background-size: cover;         /* Make the image cover the viewport */
  background-repeat: no-repeat;   /* Prevent tiling if you prefer a single image */
  background-attachment: fixed;   /* Optionally fix the background in place */
}
  </style>
</head>
<body class="home custom-background" id="page-top">
  <div class="ovatheme_container_wide">
    <div class="wrapper">
      <!-- Header -->
      <nav id="navigation" class="navbar navbar-fixed-top navbar-white header_v1">
        <div class="container">
          <div class="row">
            <div class="navbar-header col-md-3">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-dione">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a href="https://wmagm.is/" class="navbar-brand page-scroll font-family-alt letter-spacing-1 text-extra-large text-uppercase">
                <span class="blogname">World Meeting 2025</span>
              </a>
            </div>
            <div id="navbar-dione" class="navbar-collapse collapse col-md-9 pull-right">
              <ul id="menu-scroll-menu" class="nav navbar-nav font-family-alt letter-spacing-1 text-small text-uppercase">
                <li class="menu-item"><a title="Home" href="#home" class="page-scroll">Home</a></li>
                <li class="menu-item"><a title="Shop" href="https://docs.google.com/forms/d/e/1FAIpQLSf6rFvG1eiiCi-dlqB4scnFdLicWGrmht3UE8sT8G-acOM3Aw/viewform">Shop</a></li>
                <li class="menu-item"><a title="Pretours 6th - 8th May" href="https://wmagm.is/index.php/pretours/" class="page-scroll">Pretours 6th â€“ 8th May</a></li>
                <li class="menu-item"><a title="Daytours" href="https://wmagm.is/index.php/daytours/" class="page-scroll">Daytours</a></li>
                <li class="menu-item"><a title="Registration" href="https://41.wufoo.com/forms/w1chioer17zmpqi/" class="page-scroll">Registration</a></li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
      
      <!-- Main Content Section -->
      <div class="page-section">
        <div class="container">
          <!-- Here you can place your custom HTML for the dashboard -->
          <div id="dashboard-content" class="wpb-content-wrapper"  style="padding-top:90px;">
            <!-- Your dynamic dashboard content (for example, data fetched via JS) will be injected here -->
            <h2 class="text-center">Your Dashboard Content</h2>
            <!-- Insert your JavaScript-driven dashboard code below -->
            <!-- For example, if you're integrating the Google Sheets API and filtering by AuthCode -->
          </div>
        </div>
      </div>
      
      <!-- Footer -->
      <footer class="footer bg-white">
        <div class="container">
          <div class="row">
            <div class="col-sm-4">
              <div class="footer-logo xs-text-center">
                <!-- Logo or widget content can be inserted here -->
              </div>
            </div>
            <div class="col-sm-8">
              <div class="footer-social text-right">
                <!-- Social links -->
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="footer-copyright text-center border-top border-gray-light">
                <p class="font-family-alt letter-spacing-1 text-gray-dark text-small text-uppercase">
                  &copy; 2025 World Meeting 2025. All rights reserved.
                </p>
              </div>
            </div>
          </div>
        </div>
      </footer>
      
      <!-- Scroll to top button -->
      <a href="#page-top" class="page-scroll scroll-to-top">
        <i class="fa fa-angle-up"></i>
      </a>
    </div>
  </div>
  
  <!-- JavaScript References -->
  <script type="text/javascript" src="https://wmagm.is/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
  <script type="text/javascript" src="https://wmagm.is/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
  <script type="text/javascript" src="https://wmagm.is/wp-content/themes/ova-dione/assets/js/bootstrap.min.js" id="bootstrap-js"></script>
  <script type="text/javascript" src="https://wmagm.is/wp-content/themes/ova-dione/assets/js/pace.min.js" id="pace.min.js-js"></script>
  <script type="text/javascript" src="https://wmagm.is/wp-content/themes/ova-dione/assets/js/debouncer.min.js" id="debouncer.min.js-js"></script>
  <script type="text/javascript" src="https://wmagm.is/wp-content/themes/ova-dione/assets/js/jquery.easing.min.js" id="jquery.easing.min.js-js"></script>
  <!-- Other JS files as needed -->
  <script type="text/javascript" src="https://wmagm.is/wp-content/themes/ova-dione/assets/js/main.js" id="main.js-js"></script>
  
<!-- Bootstrap Bundle with Popper (if needed) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ==== CONFIGURATION: Replace these placeholders with your actual values ====
    const sheetId = '1wZLrwfU4Yv0YqcZTC85m04DSlyIUGfAZP5QGu6ASzhU'; // e.g., 1abcD_efGHIJKlmNOPQRstuVWXyz
    const apiKey = 'AIzaSyDMUFiF6kAxOT4vha6_yl-PQlHBswFpuF8'; // Your Google API key with access to Google Sheets API
    // Set the range where your data resides (headers in the first row).
    // E.g., if your data is in "Sheet1" from A1 to Z100:
    const range = 'Data!A1:BG';

    // The name of the column header that holds the auth code.
    const authCodeHeader = 'AuthCode';

    // ==== End configuration ====

    // Helper: Extract the auth code from the URL.
    function getAuthCodeFromURL() {
      // Assumes URL format: /dashboard/ABC123 (or similar)
      const parts = window.location.pathname.split('/');
      for (let i = parts.length - 1; i >= 0; i--) {
        if (parts[i].trim() !== '') {
          return parts[i].trim();
        }
      }
      return null;
    }
    function getAuthCodeFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get("session");
    }

    // Helper: Convert rows (array of arrays) into an array of objects using headers.
    function rowsToObjects(data) {
      if (!data || !data.values || data.values.length < 2) {
        return [];
      }
      const headers = data.values[0];
      return data.values.slice(1).map(row => {
        let obj = {};
        headers.forEach((header, i) => {
          obj[header] = row[i] || '';
        });
        return obj;
      });
    }

    // Function: Render the registration details in a table.
    function renderDashboard(registration) {
      const container = document.getElementById('dashboard-content');
      if (!registration) {
        container.innerHTML = `<div class="alert alert-danger" role="alert">
          No registration data found for this authentication code.
        </div>`;
        return;
      }
      
      let html =  `
  <div class="registration-details">
    <h3 class="font-family-alt text-uppercase text-center mb-4" style="letter-spacing: 2px;">
      Registration Details for Auth Key: ${registration.AuthCode}
    </h3>
    <div class="registration-item d-flex justify-content-between align-items-center mb-3">
      <span class="registration-label font-weight-bold">Entry ID:</span>
      <span class="registration-value">${registration["Entry Id"] || ''}</span>
    </div>
    <div class="registration-item d-flex justify-content-between align-items-center mb-3">
      <span class="registration-label font-weight-bold">Primary Registrant:</span>
      <span class="registration-value">${registration["Name of primary registrant"] || ''}</span>
    </div>
    <div class="registration-item d-flex justify-content-between align-items-center mb-3">
      <span class="registration-label font-weight-bold">Email:</span>
      <span class="registration-value">${registration.Email || ''}</span>
    </div>
    <div class="registration-item d-flex justify-content-between align-items-center mb-3">
      <span class="registration-label font-weight-bold">Date Created:</span>
      <span class="registration-value">${registration["Date Created"] || ''}</span>
    </div>
  </div>
`;
      container.innerHTML = html;
    }

    // Function to fetch sheet data via Google Sheets API.
    function fetchSheetData(authCode) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
      console.log('Requesting URL: ' + url);
      
      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          // Convert raw rows to objects
          const records = rowsToObjects(data);
          // Filter records where the auth code matches
          const registration = records.find(record => record[authCodeHeader] && record[authCodeHeader].trim() === authCode);
          renderDashboard(registration);
        })
        .catch(error => {
          console.error("Error fetching sheet data:", error);
          document.getElementById('dashboard-content').innerHTML =
            `<div class="alert alert-danger" role="alert">Error retrieving data.</div>`;
        });
    }

    // On DOM load, extract auth code and fetch data.
    document.addEventListener('DOMContentLoaded', () => {
      const authCode = getAuthCodeFromQuery();
      if (!authCode) {
        document.getElementById('dashboard-content').innerHTML =
          `<div class="alert alert-warning" role="alert">No authentication code provided in the URL.</div>`;
        return;
      }
      fetchSheetData(authCode);
    });
  </script>
</body>
</html>
